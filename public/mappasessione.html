<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
        margin: 3px;
      }
      #map2 {
        height: 33%;
        margin: 3px;
      }
      #map3 {
        height: 33%;
        margin: 3px;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>

      Array.prototype.max = function() {
        return Math.max.apply(null, this);
      };

      Array.prototype.min = function() {
        return Math.min.apply(null, this);
      };

      function findGetParameter(parameterName) {
          var result = null,
              tmp = [];
          location.search
              .substr(1)
              .split("&")
              .forEach(function (item) {
                tmp = item.split("=");
                if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
              });
          return result;
      }
      var username = findGetParameter("Username");
      var session = findGetParameter("Session");
      var coord = findGetParameter("Coord");
      var limit = findGetParameter("Limit");
      if(typeof (limit) === undefined || limit === null){
        limit = 0.3;
      }
      if(typeof (coord) === undefined || coord === null){
        coord = "x";
      }
      var map;
      
      function initMap() {

        // Get the data from the server.
        var flightPlanCoordinates = [] ;
        var absmax = limit;

        if(typeof (username) != undefined && typeof(session)!= undefined && username != null && session != null){
          $getResult = $.get( "../sessionDetail?Username="+username+"&Session="+session, 
            function(response, err) {
              // manipulate response
              flightPlanCoordinates = response;
          }).done(function() {
            if(flightPlanCoordinates.length>0){
              
            }else{
              map = new google.maps.Map(document.getElementById('map'), {
                center: {"lat": 41.84655, "lng": 12.62636},
                zoom: 15
              });
            }
            console.log(flightPlanCoordinates);
            for(i = 1; i < flightPlanCoordinates.length; i++){
              flightPlanCoordinatestemp = [{"lat":flightPlanCoordinates[i-1].lat,"lng":flightPlanCoordinates[i-1].lng},
              {"lat":flightPlanCoordinates[i].lat,"lng":flightPlanCoordinates[i].lng}];
              console.log(flightPlanCoordinatestemp);
              //flightPlanCoordinatestemp = flightPlanCoordinates.slice(i, i+2);
                  var flightPath = new google.maps.Polyline({
                    path: flightPlanCoordinatestemp,
                    geodesic: true,
                    strokeColor: getRandomColor( Math.abs(flightPlanCoordinates[i][coord]) ),
                    strokeOpacity: 1.0,
                    strokeWeight: 6
                  });
                  flightPath.setMap(map);
              }
          });
        }
      }

      function getRandomColor_old(value = -1) {

        var colors = Array("FF0000", "FF1000", "FF2000", "FF3000", "FF4000", "FF5000", "FF6000", "FF7000", "FF8000", "FF9000", "FFA000", "FFB000", "FFC000", "FFD000", "FFE000", "FFF000", "FFFF00", "F0FF00", "E0FF00", "D0FF00", "C0FF00", "B0FF00", "A0FF00", "90FF00", "80FF00", "70FF00", "60FF00", "50FF00", "40FF00", "30FF00", "20FF00", "10FF00");
        
        if(value >= 0 && value < colors.length){
          color = "#"+colors[31-value];
        }else{
          color = "#"+colors[Math.floor(Math.random()*colors.length)];
        }
        return color;
      }
      
      function getRandomColor(value = -1, soglia = 0.3) {
        var colors = Array("00b3fd", "fd9700", "fd0000");
        
        if(value <= 0.1 ){
          color = "#"+colors[0];
        }else{
          if(value <= 0.3){
            color = "#"+colors[1];
          }else{
            color = "#"+colors[2];
          }
        }
        return color;
      }
    </script>
	<script
	  src="..\assets\js\jquery-3.2.1.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDWG_AjxYCOnXkeMl-biHoneHbjktkDA2Y&callback=initMap" async defer></script>
  </body>
  <script>
    
	// You don't need google.maps.event.addDomListener(window, 'load', initialize);
	// if you use jQuery's $(document).ready() function.

	function initialize() {

	}
  </script>
</html>